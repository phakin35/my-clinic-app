<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏≠‡∏≤‡πÄ‡πÄ‡∏á‡∏ß Clinic - ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÅ‡∏™‡∏ô‡∏™‡∏∏‡∏Ç</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700;800&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .hidden-section { display: none; }
        .hero-bg {
            background-image: url('https://image.springnews.co.th/uploads/images/contents/w1024/2023/02/v2lndUTOu19ngpbivyf6.webp');
            background-size: cover;
            background-position: center 20%;
        }
        .glass-panel { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.6); }
        .glass-btn { background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.3); color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .glass-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        @keyframes blink { 50% { opacity: 0.5; } }
        .animate-blink { animation: blink 2s infinite; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print {
            body * { visibility: hidden; }
            #receipt-content, #receipt-content * { visibility: visible; }
            #receipt-content { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none; border: none; }
            .no-print { display: none; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700 antialiased selection:bg-teal-100 selection:text-teal-900">

    <!-- Navbar -->
    <nav class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-50 border-b border-teal-50 transition-all duration-300 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="goHome()">
                    <div class="bg-gradient-to-br from-teal-400 to-teal-600 p-2.5 rounded-2xl text-white shadow-lg shadow-teal-200 group-hover:scale-105 transition duration-300">
                        <i data-lucide="paw-print" class="w-6 h-6"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-2xl font-extrabold tracking-tight leading-none text-slate-800">‡∏≠‡∏≤‡πÄ‡πÄ‡∏á‡∏ß ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</span>
                        <span class="text-xs font-bold tracking-widest text-orange-500 uppercase">Cat Dog Clinic</span>
                    </div>
                </div>

                <div class="hidden md:flex items-center gap-8">
                    <button onclick="goHome()" class="text-gray-500 hover:text-teal-600 font-bold transition text-sm uppercase tracking-wide">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
                    <button onclick="scrollToSection('services')" class="text-gray-500 hover:text-teal-600 font-bold transition text-sm uppercase tracking-wide">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</button>
                    <button onclick="scrollToSection('doctors')" class="text-gray-500 hover:text-teal-600 font-bold transition text-sm uppercase tracking-wide">‡∏ó‡∏µ‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå</button>
                    
                    <button id="nav-contact-us" onclick="openContactModal()" class="hidden text-gray-500 hover:text-teal-600 font-bold transition text-sm uppercase tracking-wide">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</button>
                    <button id="nav-dashboard-link" onclick="goToDashboard()" class="hidden text-teal-600 hover:text-teal-800 font-bold transition text-sm uppercase tracking-wide">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>

                    <button id="btn-queue-board" onclick="toggleQueueBoard()" class="hidden text-white bg-slate-800 hover:bg-slate-700 font-bold px-3 py-1.5 rounded-lg items-center gap-2 text-sm shadow-md transition">
                        <i data-lucide="monitor" class="w-4 h-4"></i> ‡∏à‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß (TV)
                    </button>

                    <button id="btn-staff-contact" onclick="openContactModal()" class="hidden text-teal-700 hover:text-teal-900 bg-teal-50 border border-teal-200 font-bold px-3 py-1.5 rounded-lg items-center gap-2 text-sm transition">
                        <i data-lucide="message-square" class="w-4 h-4"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Admin
                    </button>

                    <button id="btn-admin-menu" onclick="goToDashboard()" class="hidden text-red-500 hover:text-red-700 font-bold items-center gap-1 transition text-sm">
                        <i data-lucide="settings" class="w-4 h-4"></i> ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
                    </button>

                    <button onclick="showAuthModal('login', 'doctor')" class="text-gray-400 hover:text-teal-600 font-medium flex items-center gap-1 transition text-sm">
                        <i data-lucide="shield-check" class="w-4 h-4"></i> ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà
                    </button>
                    
                    <div id="nav-user-info" class="hidden flex items-center gap-4 ml-2 pl-6 border-l border-gray-200">
                        <button id="btn-my-pets" onclick="openManagePetsModal()" class="hidden bg-orange-50 text-orange-600 hover:bg-orange-100 px-3 py-1.5 rounded-lg font-bold items-center gap-2 text-sm transition">
                            <i data-lucide="cat" class="w-4 h-4"></i> ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                        </button>
                        <div class="text-right">
                            <div id="user-display-name" class="text-sm font-bold text-slate-800">User</div>
                            <div id="user-role-display" class="text-xs font-semibold text-teal-600 bg-teal-50 px-2 py-0.5 rounded-full inline-block">Customer</div>
                        </div>
                        <button onclick="logout()" class="bg-slate-100 hover:bg-red-50 hover:text-red-500 p-2.5 rounded-full text-slate-400 transition shadow-sm">
                            <i data-lucide="log-out" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <div id="nav-auth-buttons" class="flex gap-3">
                        <button onclick="showAuthModal('login')" class="px-5 py-2.5 text-slate-600 font-bold hover:bg-slate-100 rounded-full transition text-sm">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                        <button onclick="showAuthModal('register')" class="px-6 py-2.5 bg-gradient-to-r from-orange-400 to-orange-500 text-white font-bold rounded-full shadow-lg shadow-orange-200 hover:shadow-orange-300 hover:-translate-y-0.5 transition flex items-center gap-2 text-sm">
                            <i data-lucide="calendar-plus" class="w-4 h-4"></i> ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <!-- 1. Landing Page -->
        <div id="landing-page" class="animate-fade-in no-print">
            <header class="hero-bg h-[600px] relative flex items-center">
                <div class="absolute inset-0 bg-gradient-to-r from-slate-900/80 via-teal-900/40 to-transparent"></div>
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full relative z-10">
                    <div class="max-w-2xl space-y-6">
                        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/20 backdrop-blur-md border border-white/30 text-white text-sm font-semibold shadow-lg">
                            <span class="w-2 h-2 rounded-full bg-orange-400 animate-pulse"></span> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
                        </div>
                        <h1 class="text-5xl md:text-7xl font-extrabold text-white leading-tight drop-shadow-sm">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡∏µ‡πâ‡∏™‡∏µ‡πà‡∏Ç‡∏≤ <br/> <span class="text-transparent bg-clip-text bg-gradient-to-r from-teal-200 to-teal-400">‡πÄ‡∏£‡∏≤‡∏î‡∏π‡πÅ‡∏•‡∏î‡πâ‡∏ß‡∏¢‡πÉ‡∏à</span></h1>
                        <p class="text-lg md:text-xl text-slate-200 font-light max-w-lg leading-relaxed">‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡∏°‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
                        <div class="pt-6 flex flex-col sm:flex-row gap-4">
                            <button onclick="handleHeroBooking()" class="bg-teal-500 hover:bg-teal-400 text-white text-lg font-bold py-4 px-10 rounded-full shadow-xl shadow-teal-900/30 transition transform hover:-translate-y-1 flex items-center justify-center gap-3">
                                <i data-lucide="calendar-check"></i> ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
                            </button>
                            <button onclick="scrollToSection('services')" class="glass-btn text-lg font-bold py-4 px-10 rounded-full shadow-lg transition duration-300">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</button>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Stats, Services, Doctors (Keep as is) -->
            <section id="services" class="py-24 bg-slate-50 relative overflow-hidden">
                <div class="max-w-7xl mx-auto px-4 relative z-10">
                    <div class="text-center mb-16 max-w-2xl mx-auto"><h2 class="text-4xl font-extrabold text-slate-800 mt-4 mb-4">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</h2></div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="glass-panel p-8 rounded-3xl shadow-sm hover:shadow-xl transition group"><div class="w-16 h-16 bg-white text-teal-600 rounded-2xl flex items-center justify-center mb-6 shadow-sm"><i data-lucide="stethoscope" class="w-8 h-8"></i></div><h3 class="text-2xl font-bold mb-3 text-slate-800">General Care</h3><p class="text-slate-600">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</p></div>
                        <div class="glass-panel p-8 rounded-3xl shadow-sm hover:shadow-xl transition group"><div class="w-16 h-16 bg-white text-orange-500 rounded-2xl flex items-center justify-center mb-6 shadow-sm"><i data-lucide="heart-pulse" class="w-8 h-8"></i></div><h3 class="text-2xl font-bold mb-3 text-slate-800">Surgery</h3><p class="text-slate-600">‡∏´‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p></div>
                        <div class="glass-panel p-8 rounded-3xl shadow-sm hover:shadow-xl transition group"><div class="w-16 h-16 bg-white text-blue-500 rounded-2xl flex items-center justify-center mb-6 shadow-sm"><i data-lucide="scissors" class="w-8 h-8"></i></div><h3 class="text-2xl font-bold mb-3 text-slate-800">Grooming</h3><p class="text-slate-600">‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏±‡∏î‡∏Ç‡∏ô‡πÇ‡∏î‡∏¢‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£</p></div>
                    </div>
                </div>
            </section>
            <section id="doctors" class="py-24 bg-white relative">
                <div class="max-w-7xl mx-auto px-4">
                    <div class="text-center mb-16 max-w-2xl mx-auto"><span class="text-teal-600 font-bold tracking-wider uppercase text-sm bg-teal-50 px-3 py-1 rounded-full">Our Veterinarians</span><h2 class="text-4xl font-extrabold text-slate-800 mt-4 mb-4">‡∏ó‡∏µ‡∏°‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2></div>
                    <div id="landingDoctorsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-10"></div>
                </div>
            </section>
        </div>

        <!-- 2. Application Screen -->
        <div id="app-screen" class="hidden-section max-w-7xl mx-auto p-4 md:p-8 min-h-screen no-print">
            <!-- A. Customer View -->
            <section id="role-customer" class="hidden-section fade-in">
                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="lg:w-1/3">
                        <div class="glass-panel p-6 rounded-2xl shadow-lg border-t-4 border-teal-500 sticky top-24">
                            <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-teal-800 flex items-center gap-2"><i data-lucide="calendar-plus"></i> ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ï‡∏£‡∏ß‡∏à</h2></div>
                            <form onsubmit="handleBooking(event)" class="space-y-4">
                                <div class="space-y-1"><label class="text-sm font-bold text-slate-600">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</label><input type="text" id="cust-ownerName" name="ownerName" readonly class="w-full bg-slate-100 border-0 rounded-lg p-2.5 text-slate-500 text-sm cursor-not-allowed"></div>
                                <div class="bg-teal-50/50 p-3 rounded-xl border border-teal-100"><label class="text-xs font-bold text-teal-700 mb-1.5 block">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label><select id="petSelect" onchange="fillPetInfo(this.value)" class="w-full border border-teal-200 p-2 rounded-lg bg-white outline-none focus:ring-2 focus:ring-teal-500 mb-2"><option value="" disabled selected>-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option></select><p class="text-xs text-slate-400 italic">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‚ÜóÔ∏è</p></div>
                                <div class="grid grid-cols-2 gap-3"><div class="space-y-1"><label class="text-sm font-bold text-slate-600">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</label><input name="petName" id="bk-petName" required class="w-full border p-2 rounded-lg bg-slate-50" readonly></div><div class="space-y-1"><label class="text-sm font-bold text-slate-600">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><input name="petType" id="bk-petType" required class="w-full border p-2 rounded-lg bg-slate-50" readonly></div></div>
                                <div class="grid grid-cols-3 gap-2"><div class="space-y-1"><label class="text-xs font-bold text-slate-500">‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</label><input name="breed" id="bk-breed" class="w-full border p-2 rounded-lg text-sm bg-slate-50" readonly></div><div class="space-y-1"><label class="text-xs font-bold text-slate-500">‡∏ô‡∏ô.(kg)</label><input name="weight" id="bk-weight" class="w-full border p-2 rounded-lg text-sm bg-slate-50" readonly></div><div class="space-y-1"><label class="text-xs font-bold text-slate-500">‡∏™‡∏π‡∏á(cm)</label><input name="height" id="bk-height" class="w-full border p-2 rounded-lg text-sm bg-slate-50" readonly></div></div>
                                <div class="border-t border-slate-200 pt-3"><div class="grid grid-cols-2 gap-2 mb-3"><div class="space-y-1"><label class="text-sm font-bold text-slate-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" name="date" required class="w-full border p-2 rounded-lg outline-none focus:ring-2 focus:ring-teal-500"></div><div class="space-y-1"><label class="text-sm font-bold text-slate-600">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label><select name="timeSlot" required class="w-full border p-2 rounded-lg bg-white outline-none focus:ring-2 focus:ring-teal-500"><option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="09:00-09:30">09:00</option><option value="09:30-10:00">09:30</option><option value="10:00-10:30">10:00</option><option value="10:30-11:00">10:30</option><option value="11:00-11:30">11:00</option><option value="13:00-13:30">13:00</option><option value="13:30-14:00">13:30</option><option value="14:00-14:30">14:00</option><option value="14:30-15:00">14:30</option></select></div></div><div class="space-y-1"><label class="text-sm font-bold text-slate-600">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</label><textarea name="symptoms" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏Å‡∏≤‡∏£..." class="w-full border p-2 rounded-lg outline-none focus:ring-2 focus:ring-teal-500"></textarea></div></div>
                                <input type="hidden" name="phone" value="-" />
                                <button type="submit" class="w-full bg-teal-600 text-white font-bold py-3 rounded-lg hover:bg-teal-700 shadow-lg transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                            </form>
                        </div>
                    </div>
                    <div class="lg:w-2/3">
                        <h2 class="text-2xl font-bold text-slate-700 mb-4 flex items-center gap-2"><i data-lucide="history" class="text-orange-500"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
                        <div id="customerHistory" class="space-y-3"></div>
                    </div>
                </div>
            </section>

            <!-- B. Reception View (Fixed Buttons) -->
            <section id="role-reception" class="hidden-section fade-in">
                <div class="flex justify-between items-center mb-6">
                    <div><h2 class="text-3xl font-bold text-slate-800">‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö (Reception)</h2><p class="text-slate-500 mt-1">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏•‡∏∞‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</p></div>
                    <button onclick="document.getElementById('walkInModal').classList.remove('hidden')" class="bg-indigo-600 text-white px-6 py-3 rounded-full font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition"><i data-lucide="plus-circle" class="inline w-5 h-5 mr-1"></i> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Walk-in</button>
                </div>
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="glass-panel p-4 rounded-3xl border-l-4 border-yellow-400"><div class="text-xs text-yellow-600 font-bold uppercase">‡∏£‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</div><div class="text-3xl font-extrabold text-slate-800" id="stat-pending">0</div></div>
                    <div class="glass-panel p-4 rounded-3xl border-l-4 border-teal-500"><div class="text-xs text-teal-600 font-bold uppercase">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à</div><div class="text-3xl font-extrabold text-slate-800" id="stat-waiting">0</div></div>
                    <div class="glass-panel p-4 rounded-3xl border-l-4 border-purple-500"><div class="text-xs text-purple-600 font-bold uppercase">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div><div class="text-3xl font-extrabold text-slate-800" id="stat-pharmacy">0</div></div>
                    <div class="glass-panel p-4 rounded-3xl border-l-4 border-green-500"><div class="text-xs text-green-600 font-bold uppercase">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div><div class="text-3xl font-extrabold text-slate-800" id="stat-completed">0</div></div>
                </div>
                <div class="mb-6 relative">
                    <i data-lucide="search" class="absolute left-4 top-4 text-slate-400 w-5 h-5"></i>
                    <input type="text" id="searchInput" onkeyup="loadAppointments()" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á, ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£..." class="w-full bg-white border border-slate-200 rounded-2xl py-4 pl-12 pr-4 text-slate-600 shadow-sm focus:ring-2 focus:ring-indigo-500 outline-none transition text-lg">
                </div>
                <div class="bg-white rounded-3xl shadow-xl shadow-slate-100 border border-slate-100 overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50/80 border-b border-slate-100">
                            <tr><th class="p-5 font-bold text-slate-500 text-sm">‡∏Ñ‡∏¥‡∏ß</th><th class="p-5 font-bold text-slate-500 text-sm">‡πÄ‡∏ß‡∏•‡∏≤</th><th class="p-5 font-bold text-slate-500 text-sm">‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</th><th class="p-5 font-bold text-slate-500 text-sm">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</th><th class="p-5 font-bold text-slate-500 text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th class="p-5 font-bold text-slate-500 text-sm text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
                        </thead>
                        <tbody id="receptionTable" class="divide-y divide-slate-50"></tbody>
                    </table>
                </div>
            </section>

            <!-- C. Doctor View -->
            <section id="role-doctor" class="hidden-section fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[80vh]">
                    <div class="bg-white rounded-2xl shadow border overflow-hidden flex flex-col">
                        <div class="p-4 bg-teal-50 border-b font-bold text-teal-800 flex items-center gap-2"><i data-lucide="list"></i> ‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à</div>
                        <div id="doctorList" class="divide-y overflow-y-auto flex-1"></div>
                    </div>
                    <div class="lg:col-span-2 bg-white rounded-2xl shadow border flex flex-col relative">
                        <div id="no-exam" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400"><i data-lucide="stethoscope" class="w-16 h-16 mb-2 opacity-50"></i><p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à</p></div>
                        <div id="exam-room" class="hidden flex flex-col h-full">
                            <div class="p-6 border-b bg-blue-50 flex justify-between items-center">
                                <div><h3 id="exam-title" class="text-xl font-bold text-blue-900">...</h3><p class="text-sm text-slate-500" id="exam-subtitle">...</p></div>
                                <div class="text-right text-xs text-slate-500 bg-white p-2 rounded border"><div id="exam-details-mini"></div></div>
                            </div>
                            <div class="p-6 space-y-4 flex-1 overflow-y-auto">
                                <input type="hidden" id="exam-id">
                                <div><label class="block font-bold mb-2 text-slate-700">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢ (Diagnosis)</label><textarea id="doc-diagnosis" class="w-full border p-3 h-32 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à..."></textarea></div>
                                <div><label class="block font-bold mb-2 text-slate-700">‡∏™‡∏±‡πà‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤ (Prescription)</label><textarea id="doc-prescription" class="w-full border p-3 h-32 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤..."></textarea></div>
                            </div>
                            <div class="p-4 border-t bg-gray-50 flex justify-end gap-2">
                                <button onclick="cancelExam()" class="px-4 py-2 text-slate-500 hover:bg-gray-200 rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button onclick="submitExam()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold shadow hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- D. ADMIN VIEW (Fixed) -->
            <section id="role-admin" class="hidden-section fade-in">
                <div class="bg-white rounded-3xl p-8 shadow-xl">
                    <h2 class="text-3xl font-bold text-red-600 mb-6 flex items-center gap-2"><i data-lucide="settings"></i> ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Admin)</h2>
                    <div class="flex border-b mb-6">
                        <button onclick="switchAdminTab('users')" id="tab-users" class="px-6 py-2 font-bold border-b-2 border-red-500 text-red-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                        <button onclick="switchAdminTab('apps')" id="tab-apps" class="px-6 py-2 font-bold text-slate-400 hover:text-red-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
                        <button onclick="switchAdminTab('doctors')" id="tab-doctors" class="px-6 py-2 font-bold text-slate-400 hover:text-red-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå</button>
                        <button onclick="switchAdminTab('messages')" id="tab-messages" class="px-6 py-2 font-bold text-slate-400 hover:text-red-500">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                    </div>
                    <div id="admin-users"><div class="mb-4 flex justify-end"><button onclick="openAddStaffModal()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-red-600 flex gap-2"><i data-lucide="user-plus" class="w-4 h-4"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button></div><table class="w-full text-left border-collapse"><thead class="bg-slate-100"><tr><th class="p-3">ID</th><th class="p-3">Username</th><th class="p-3">‡∏ä‡∏∑‡πà‡∏≠</th><th class="p-3">Role</th><th class="p-3 text-right">Action</th></tr></thead><tbody id="adminUserList" class="divide-y"></tbody></table></div>
                    <div id="admin-apps" class="hidden-section"><table class="w-full text-left border-collapse"><thead class="bg-slate-100"><tr><th class="p-3">ID</th><th class="p-3">‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤</th><th class="p-3">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th class="p-3">‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</th><th class="p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th class="p-3 text-right">Action</th></tr></thead><tbody id="adminAppList" class="divide-y"></tbody></table></div>
                    <div id="admin-doctors" class="hidden-section"><div class="mb-4 flex justify-end"><button onclick="openAddDoctor()" class="bg-teal-500 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-teal-600 flex gap-2"><i data-lucide="user-plus" class="w-4 h-4"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≠</button></div><div id="adminDoctorsList" class="grid grid-cols-1 gap-4"></div></div>
                    <div id="admin-messages" class="hidden-section"><div id="adminMessagesList" class="space-y-3"></div></div>
                </div>
            </section>
        </div>
    </main>

    <!-- üåü Popup & Confirm Modals -->
    <div id="customPopup" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4 opacity-0 transition-opacity duration-300"><div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-sm text-center transform scale-90 transition-transform duration-300" id="customPopupContent"><div id="popupIcon" class="mb-5 flex justify-center"></div><h3 id="popupTitle" class="text-2xl font-bold text-gray-800 mb-2"></h3><p id="popupMessage" class="text-gray-500 mb-6 text-sm"></p><button onclick="closePopup()" class="bg-teal-600 text-white px-8 py-3 rounded-xl font-bold shadow hover:bg-teal-700 transition w-full">‡∏ï‡∏Å‡∏•‡∏á</button></div></div>
    <div id="customConfirm" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[110] p-4 opacity-0 transition-opacity duration-300"><div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-sm text-center transform scale-90 transition-transform duration-300" id="customConfirmContent"><div class="mb-5 flex justify-center"><div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center"><i data-lucide="alert-triangle" class="w-8 h-8 text-yellow-600"></i></div></div><h3 id="confirmTitle" class="text-2xl font-bold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?</h3><p id="confirmMessage" class="text-gray-500 mb-6 text-sm">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</p><div class="flex gap-3"><button onclick="closeConfirm(false)" class="flex-1 px-4 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button id="confirmBtn" class="flex-1 bg-red-500 text-white px-4 py-3 rounded-xl font-bold shadow hover:bg-red-600 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button></div></div></div>
    
    <!-- üåü Message Detail Modal -->
    <div id="messageDetailModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[90] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-md p-6 relative shadow-2xl"><button onclick="document.getElementById('messageDetailModal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button><h3 class="text-xl font-bold mb-4 text-teal-800 flex items-center gap-2"><i data-lucide="mail-open"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3><div class="space-y-4"><div class="p-3 bg-slate-50 rounded-lg"><p class="text-xs text-slate-500 font-bold uppercase">‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á</p><p class="text-slate-800 font-medium" id="msg-sender">-</p></div><div class="p-3 bg-slate-50 rounded-lg"><p class="text-xs text-slate-500 font-bold uppercase">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</p><p class="text-slate-800 font-medium" id="msg-subject">-</p></div><div><p class="text-xs text-slate-500 font-bold uppercase mb-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p><div class="p-4 bg-white border border-slate-200 rounded-lg text-slate-600 text-sm whitespace-pre-wrap min-h-[100px]" id="msg-body">-</div></div><div class="text-right text-xs text-slate-400" id="msg-date"></div></div><div class="mt-6 flex justify-end"><button onclick="document.getElementById('messageDetailModal').classList.add('hidden')" class="bg-teal-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-teal-700">‡∏õ‡∏¥‡∏î</button></div></div></div>

    <!-- Queue Board -->
    <div id="queueBoard" class="hidden fixed inset-0 z-[100] bg-slate-900 text-white flex flex-col no-print"><div class="flex justify-between items-center p-6 border-b border-slate-700 bg-slate-800"><div class="flex items-center gap-4"><div class="bg-teal-500 p-2 rounded-lg"><i data-lucide="monitor" class="w-8 h-8"></i></div><div><h1 class="text-3xl font-bold">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h1><p class="text-slate-400">Queue Monitor</p></div></div><button onclick="toggleQueueBoard()" class="text-slate-400 hover:text-white bg-slate-700 p-2 rounded-full"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="flex-1 grid grid-cols-3 divide-x divide-slate-700"><div class="col-span-2 p-12 flex flex-col items-center justify-center bg-slate-900 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-indigo-900/20 to-teal-900/20"></div><h2 class="text-4xl font-bold text-teal-400 mb-8 uppercase tracking-widest relative z-10">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à / Calling</h2><div id="board-current" class="text-center relative z-10 w-full"><div class="text-slate-500 text-2xl">...</div></div></div><div class="col-span-1 flex flex-col bg-slate-800/50"><div class="flex-1 p-6 border-b border-slate-700"><h3 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2"><i data-lucide="clock"></i> ‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à (Waiting)</h3><div id="board-waiting" class="space-y-3"></div></div><div class="flex-1 p-6 bg-slate-800"><h3 class="text-xl font-bold text-purple-400 mb-4 flex items-center gap-2"><i data-lucide="pill"></i> ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏¢‡∏≤ (Pharmacy)</h3><div id="board-pharmacy" class="space-y-3"></div></div></div></div></div>

    <!-- Modals (Contact, Pets, Doctor, Auth, Payment, Receipt, Details, Walk-in, AddStaff, EditApp) -->
    <div id="contactModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[90] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-md p-6 relative shadow-2xl"><button onclick="document.getElementById('contactModal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button><h3 class="text-xl font-bold mb-4 text-teal-800 flex items-center gap-2"><i data-lucide="mail"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3><form onsubmit="sendContactMessage(event)" class="space-y-4"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label><input name="senderName" id="contact-name" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" class="w-full border p-2.5 rounded-lg outline-none focus:ring-2 focus:ring-teal-500"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label><input name="subject" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£, ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤" class="w-full border p-2.5 rounded-lg outline-none focus:ring-2 focus:ring-teal-500"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label><textarea name="message" required rows="4" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." class="w-full border p-2.5 rounded-lg outline-none focus:ring-2 focus:ring-teal-500 resize-none"></textarea></div><button type="submit" class="w-full bg-teal-600 text-white font-bold py-2.5 rounded-lg hover:bg-teal-700 shadow transition flex items-center justify-center gap-2"><i data-lucide="send" class="w-4 h-4"></i> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button></form></div></div>
    <div id="managePetsModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-md p-6 relative"><button onclick="document.getElementById('managePetsModal').classList.add('hidden')" class="absolute top-4 right-4"><i data-lucide="x"></i></button><h3 class="text-xl font-bold mb-4 text-teal-800 flex items-center gap-2"><i data-lucide="cat"></i> ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3><div id="myPetsList" class="space-y-3 mb-6 max-h-[300px] overflow-y-auto"></div><button onclick="openAddPet()" class="w-full bg-orange-100 text-orange-600 font-bold py-2 rounded-lg border border-orange-200 hover:bg-orange-200 flex justify-center items-center gap-2"><i data-lucide="plus-circle" class="w-4 h-4"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</button></div></div>
    <div id="addPetModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[80] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-md p-6 relative"><button onclick="document.getElementById('addPetModal').classList.add('hidden')" class="absolute top-4 right-4"><i data-lucide="x"></i></button><h3 id="petModalTitle" class="text-xl font-bold mb-4 text-orange-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</h3><form onsubmit="savePet(event)" class="space-y-3"><input type="hidden" id="pet-edit-index" value=""><div class="grid grid-cols-2 gap-3"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</label><input name="petName" id="input-petName" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á" class="w-full border p-2 rounded-lg"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select name="petType" id="input-petType" class="w-full border p-2 rounded-lg bg-white"><option value="dog">‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</option><option value="cat">‡πÅ‡∏°‡∏ß</option><option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select></div></div><div class="grid grid-cols-3 gap-2"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</label><input name="breed" id="input-breed" placeholder="‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå" class="border p-2 rounded w-full"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ô‡∏ô.(kg)</label><input name="weight" id="input-weight" class="border p-2 rounded w-full"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏™‡∏π‡∏á(cm)</label><input name="height" id="input-height" class="border p-2 rounded w-full"></div></div><button type="submit" class="w-full bg-orange-500 text-white font-bold py-2 rounded-lg hover:bg-orange-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></form></div></div>
    <div id="doctorModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[90] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-md p-6 relative"><button onclick="document.getElementById('doctorModal').classList.add('hidden')" class="absolute top-4 right-4"><i data-lucide="x"></i></button><h3 id="doctorModalTitle" class="text-xl font-bold mb-4 text-teal-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏û‡∏ó‡∏¢‡πå</h3><form onsubmit="saveDoctor(event)" class="space-y-4"><input type="hidden" id="doctor-edit-index" value=""><div class="space-y-2"><label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input name="name" id="doc-input-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏û.‡∏ç. ‡πÉ‡∏à‡∏î‡∏µ ‡∏£‡∏±‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå" class="w-full border p-2.5 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none"></div><div class="space-y-2"><label class="block text-sm font-medium text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</label><input name="specialty" id="doc-input-specialty" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ" class="w-full border p-2.5 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none"></div><div class="space-y-2"><label class="block text-sm font-medium text-gray-700">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label><div class="flex items-center gap-4"><img id="doc-preview" src="https://via.placeholder.com/100" class="w-16 h-16 rounded-full object-cover border border-gray-200 hidden"><input type="file" id="doc-input-file" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-teal-50 file:text-teal-700 hover:file:bg-teal-100"><input type="hidden" name="image" id="doc-input-image"></div></div><button type="submit" class="w-full bg-teal-600 text-white font-bold py-2.5 rounded-lg hover:bg-teal-700 shadow-md transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></form></div></div>
    <div id="authModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-md p-6 relative"><button onclick="document.getElementById('authModal').classList.add('hidden')" class="absolute top-4 right-4"><i data-lucide="x"></i></button><h3 id="authModalTitle" class="text-xl font-bold mb-4">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3><form id="loginForm" class="space-y-3"><div><label class="block text-sm font-bold text-slate-600 mb-1">Username</label><input name="username" required class="w-full border p-3 rounded-lg"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">Password</label><input type="password" name="password" required class="w-full border p-3 rounded-lg"></div><button type="submit" class="w-full bg-teal-600 text-white font-bold py-3 rounded-lg">Log In</button><div class="text-center text-sm text-blue-600 cursor-pointer hover:underline" onclick="toggleAuthMode('register')">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</div></form><form id="registerForm" class="hidden-section space-y-3"><div class="p-3 bg-blue-50 text-blue-800 text-xs rounded border border-blue-200 mb-2">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input name="name" required class="w-full border p-3 rounded-lg"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">Username</label><input name="username" required class="w-full border p-3 rounded-lg"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">Password</label><input type="password" name="password" required class="w-full border p-3 rounded-lg"></div><input type="hidden" name="role" value="customer"><button type="submit" class="w-full bg-orange-500 text-white font-bold py-3 rounded-lg">Register</button><div class="text-center text-sm text-blue-600 cursor-pointer hover:underline" onclick="toggleAuthMode('login')">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß?</div></form></div></div>
    <div id="paymentModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-md p-6 relative"><button onclick="closePaymentModal()" class="absolute top-4 right-4"><i data-lucide="x"></i></button><h3 class="text-xl font-bold text-purple-800 mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h3><div class="bg-purple-50 p-4 rounded-lg mb-4 text-sm space-y-2"><p><strong>‡∏ú‡∏•‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢:</strong> <span id="pay-diag" class="text-purple-900 font-medium">-</span></p><p><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤:</strong> <span id="pay-rx" class="text-purple-900 font-medium">-</span></p></div><form onsubmit="submitPayment(event)" class="space-y-4"><input type="hidden" id="pay-id"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</label><input type="number" id="pay-price" required class="w-full border p-3 rounded-lg text-xl text-right" placeholder="0.00"></div><button type="submit" class="w-full bg-purple-600 text-white px-6 py-2 rounded-lg font-bold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</button></form></div></div>
    <div id="receiptModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[90] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-md overflow-hidden relative shadow-2xl"><div class="bg-teal-600 p-4 text-white flex justify-between items-center"><h3 class="font-bold text-lg flex items-center gap-2"><i data-lucide="receipt"></i> ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h3><button onclick="document.getElementById('receiptModal').classList.add('hidden')" class="hover:bg-teal-700 p-1 rounded"><i data-lucide="x"></i></button></div><div class="p-6 bg-white" id="receipt-preview"></div><div class="p-4 border-t bg-white flex justify-end gap-2"><button onclick="document.getElementById('receiptModal').classList.add('hidden')" class="px-4 py-2 text-slate-500 hover:bg-gray-100 rounded-lg">‡∏õ‡∏¥‡∏î</button><button onclick="downloadPDF()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-red-600 flex items-center gap-2"><i data-lucide="file-down" class="w-4 h-4"></i> PDF</button><button onclick="printReceipt()" class="bg-teal-600 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-teal-700 flex items-center gap-2"><i data-lucide="printer" class="w-4 h-4"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå</button></div></div></div>
    <div id="receipt-content" class="hidden bg-white p-8 max-w-2xl mx-auto text-slate-800"></div>
    <div id="detailsModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[80] p-4 no-print"><div class="bg-white rounded-2xl w-full max-w-lg p-0 overflow-hidden relative"><div class="bg-teal-600 p-4 text-white flex justify-between"><h3 class="font-bold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3><button onclick="document.getElementById('detailsModal').classList.add('hidden')"><i data-lucide="x"></i></button></div><div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto"><div class="flex gap-4 border-b pb-4"><div class="text-3xl bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center"><span id="det-queueNo" class="text-xl font-bold text-teal-700">Q---</span></div><div><h4 class="text-xl font-bold" id="det-petName">...</h4><p class="text-sm text-slate-500" id="det-petInfo">...</p></div></div><div class="grid grid-cols-2 text-sm"><div><span class="text-slate-400 block">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</span><span id="det-owner">...</span></div><div><span class="text-slate-400 block">‡πÄ‡∏ß‡∏•‡∏≤</span><span id="det-date">...</span></div></div><div><span class="text-slate-400 text-xs block">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</span><p id="det-symptoms" class="text-sm">...</p></div><div class="bg-blue-50 p-3 rounded"><span class="text-blue-500 text-xs block">‡∏ú‡∏•‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢</span><p id="det-diagnosis" class="text-sm">-</p></div><div class="bg-green-50 p-3 rounded"><span class="text-green-600 text-xs block">‡∏¢‡∏≤</span><p id="det-prescription" class="text-sm">-</p></div><div class="text-right pt-2"><span class="text-2xl font-bold text-teal-600" id="det-price">0</span> THB</div></div></div></div>
    <div id="walkInModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-[70] p-4 no-print"><div class="bg-white rounded-2xl p-6 w-full max-w-md relative"><button onclick="document.getElementById('walkInModal').classList.add('hidden')" class="absolute top-4 right-4"><i data-lucide="x"></i></button><h3 class="text-xl font-bold mb-4">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Walk-in</h3><form onsubmit="handleWalkIn(event)" class="space-y-3"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</label><input name="ownerName" required class="w-full border p-2 rounded-lg"></div><div class="flex gap-2"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</label><input name="petName" required class="w-full border p-2 rounded-lg"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select name="petType" class="border p-2 rounded-lg"><option value="dog">‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</option><option value="cat">‡πÅ‡∏°‡∏ß</option></select></div></div><div class="grid grid-cols-3 gap-2"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</label><input name="breed" class="border p-2 rounded w-full"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ô‡∏ô.(kg)</label><input name="weight" class="border p-2 rounded w-full"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏™‡∏π‡∏á(cm)</label><input name="height" class="border p-2 rounded w-full"></div></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</label><textarea name="symptoms" required class="w-full border p-2 rounded-lg"></textarea></div><button type="submit" class="w-full bg-indigo-600 text-white font-bold py-2 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></form></div></div>
    <div id="addStaffModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-[80] p-4 no-print"><div class="bg-white rounded-xl p-6 w-full max-w-sm relative"><button onclick="document.getElementById('addStaffModal').classList.add('hidden')" class="absolute top-4 right-4"><i data-lucide="x"></i></button><h3 class="text-lg font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3><form onsubmit="addStaff(event)" class="space-y-3"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input name="name" required class="w-full border p-2 rounded"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">Username</label><input name="username" required class="w-full border p-2 rounded"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">Password</label><input type="password" name="password" required class="w-full border p-2 rounded"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">Role</label><select name="role" class="w-full border p-2 rounded"><option value="doctor">‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå</option><option value="reception">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option><option value="admin">Admin</option></select></div><button type="submit" class="w-full bg-red-500 text-white font-bold py-2 rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></form></div></div>
    <div id="editAppModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-[80] p-4 no-print"><div class="bg-white rounded-xl p-6 w-full max-w-md relative"><button onclick="document.getElementById('editAppModal').classList.add('hidden')" class="absolute top-4 right-4"><i data-lucide="x"></i></button><h3 class="text-lg font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</h3><form onsubmit="updateAppointmentAdmin(event)" class="space-y-3"><input type="hidden" id="edit-id"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</label><input id="edit-owner" name="ownerName" class="w-full border p-2 rounded" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</label><input id="edit-pet" name="petName" class="w-full border p-2 rounded" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á"></div><div class="grid grid-cols-2 gap-2"><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="edit-date" name="date" class="border p-2 rounded w-full"></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡πÄ‡∏ß‡∏•‡∏≤</label><select id="edit-time" name="timeSlot" class="border p-2 rounded w-full"><option value="09:00-09:30">09:00</option><option value="09:30-10:00">09:30</option></select></div></div><div><label class="block text-sm font-bold text-slate-600 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select id="edit-status" name="status" class="w-full border p-2 rounded"><option value="pending">‡∏£‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</option><option value="waiting">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à</option><option value="in_consult">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à</option><option value="pharmacy">‡∏£‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</option><option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option></select></div><button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></form></div></div>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-300 py-12 border-t border-slate-800 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center gap-2 mb-4">
                        <div class="bg-teal-600 p-1.5 rounded-lg text-white"><i data-lucide="paw-print" class="w-5 h-5"></i></div>
                        <span class="text-xl font-extrabold text-white tracking-tight">‡∏≠‡∏≤‡πÄ‡πÄ‡∏á‡∏ß Clinic</span>
                    </div>
                    <p class="text-sm text-slate-400 leading-relaxed">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏¢‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡∏µ‡πâ‡∏™‡∏µ‡πà‡∏Ç‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û</p>
                </div>
                <div><h4 class="text-white font-bold mb-4 uppercase text-sm tracking-wider">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</h4><ul class="space-y-2 text-sm"><li><a href="#" onclick="goHome()" class="hover:text-teal-400 transition">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li><li><a href="#" onclick="scrollToSection('services')" class="hover:text-teal-400 transition">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</a></li><li><a href="#" onclick="showAuthModal('login')" class="hover:text-teal-400 transition">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a></li></ul></div>
                <div><h4 class="text-white font-bold mb-4 uppercase text-sm tracking-wider">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h4><ul class="space-y-2 text-sm"><li class="flex items-start gap-2"><i data-lucide="map-pin" class="w-4 h-4 mt-1 text-teal-500"></i><span>123 ‡∏ñ.‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡πÄ‡∏Ç‡∏ï‡∏ß‡∏±‡∏í‡∏ô‡∏≤<br>‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£ 10110</span></li><li class="flex items-center gap-2"><i data-lucide="phone" class="w-4 h-4 text-teal-500"></i><span>02-123-4567</span></li></ul></div>
                <div><h4 class="text-white font-bold mb-4 uppercase text-sm tracking-wider">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h4><div class="flex gap-4"><a href="#" class="bg-slate-800 p-2 rounded-full hover:bg-teal-600 hover:text-white transition"><i data-lucide="facebook" class="w-5 h-5"></i></a><a href="#" class="bg-slate-800 p-2 rounded-full hover:bg-pink-500 hover:text-white transition"><i data-lucide="instagram" class="w-5 h-5"></i></a></div></div>
            </div>
            <div class="border-t border-slate-800 pt-8 text-center text-sm text-slate-500">&copy; 2025 Ah-Ngaew Clinic. All rights reserved.</div>
        </div>
    </footer>

    <script>
        lucide.createIcons();
        const API_URL = '/api';
        var appointmentsData = [];
        var confirmCallback = null;

        // üåü Helper to convert status to Thai
        function statusToThai(status) {
            const map = {
                'pending': '‡∏£‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô',
                'waiting': '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à',
                'in_consult': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à',
                'pharmacy': '‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô',
                'completed': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'
            };
            return map[status] || status;
        }

        // üåü POPUP FUNCTION
        function showPopup(title, message, type = 'success') {
            const modal = document.getElementById('customPopup');
            const content = document.getElementById('customPopupContent');
            const iconContainer = document.getElementById('popupIcon');
            const titleEl = document.getElementById('popupTitle');
            const msgEl = document.getElementById('popupMessage');
            titleEl.innerText = title; msgEl.innerText = message;
            if (type === 'success') { iconContainer.innerHTML = '<div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center animate-bounce"><i data-lucide="check" class="w-8 h-8 text-green-600"></i></div>'; } 
            else if (type === 'error') { iconContainer.innerHTML = '<div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center animate-pulse"><i data-lucide="x" class="w-8 h-8 text-red-600"></i></div>'; } 
            else { iconContainer.innerHTML = '<div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center"><i data-lucide="info" class="w-8 h-8 text-blue-600"></i></div>'; }
            lucide.createIcons(); modal.classList.remove('hidden'); setTimeout(() => { modal.classList.remove('opacity-0'); content.classList.remove('scale-90'); content.classList.add('scale-100'); }, 10);
        }
        function closePopup() {
            const modal = document.getElementById('customPopup'); const content = document.getElementById('customPopupContent');
            modal.classList.add('opacity-0'); content.classList.remove('scale-100'); content.classList.add('scale-90'); setTimeout(() => modal.classList.add('hidden'), 300);
        }
        
        // üåü CONFIRM FUNCTION
        function showConfirm(title, message, callback) {
            const modal = document.getElementById('customConfirm');
            document.getElementById('confirmTitle').innerText = title;
            document.getElementById('confirmMessage').innerText = message;
            confirmCallback = callback;
            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.remove('opacity-0'); }, 10);
        }
        function closeConfirm(isConfirmed) {
            const modal = document.getElementById('customConfirm');
            modal.classList.add('opacity-0');
            setTimeout(() => { 
                modal.classList.add('hidden');
                if (isConfirmed && confirmCallback) confirmCallback();
                confirmCallback = null;
            }, 300);
        }
        document.getElementById('confirmBtn').addEventListener('click', () => closeConfirm(true));

        // --- PET MANAGEMENT ---
        function getMyPets() { 
            const u = localStorage.getItem('username');
            if(!u) return [];
            return JSON.parse(localStorage.getItem('happypet_pets_'+u)||'[]'); 
        }
        function savePet(e) { 
            e.preventDefault(); 
            const p = Object.fromEntries(new FormData(e.target)); 
            const list = getMyPets(); 
            const index = document.getElementById('pet-edit-index').value;
            if (index !== "") list[index] = p; else list.push(p);
            const u = localStorage.getItem('username'); 
            if(u) localStorage.setItem('happypet_pets_'+u, JSON.stringify(list)); 
            document.getElementById('addPetModal').classList.add('hidden'); 
            e.target.reset(); 
            openManagePetsModal(); updatePetDropdown(); 
            showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success'); 
        }
        function deletePet(index) { showConfirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', () => { let pets = getMyPets(); pets.splice(index, 1); localStorage.setItem('happypet_pets_'+localStorage.getItem('username'), JSON.stringify(pets)); renderPetList(); updatePetDropdown(); showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); }); }
        function updatePetDropdown() {
            const s = document.getElementById('petSelect'); if(!s) return; s.innerHTML = '<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
            getMyPets().forEach((p,i) => { const o = document.createElement('option'); o.value=i; o.text=`${p.petName} (${p.petType})`; s.appendChild(o); });
        }
        function fillPetInfo(i) {
            const p = getMyPets()[i];
            if(p) { ['petName','petType','breed','weight','height'].forEach(k => document.getElementById('bk-'+k).value = p[k]||''); }
        }
        function openManagePetsModal() { document.getElementById('managePetsModal').classList.remove('hidden'); renderPetList(); }
        function renderPetList() {
            const pets = getMyPets(); const list = document.getElementById('myPetsList'); list.innerHTML = '';
            if (pets.length === 0) { list.innerHTML = '<p class="text-center text-slate-400 italic py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</p>'; return; }
            pets.forEach((pet, index) => {
                const petJson = JSON.stringify(pet).replace(/"/g, '&quot;');
                list.innerHTML += `<div class="flex justify-between items-center bg-slate-50 p-3 rounded-lg border border-slate-200"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-lg shadow-sm">${pet.petType === 'dog' ? 'üê∂' : (pet.petType === 'cat' ? 'üê±' : 'üêæ')}</div><div><div class="font-bold text-slate-800">${pet.petName}</div><div class="text-xs text-slate-500">${pet.breed || '-'}</div></div></div><div class="flex gap-2"><button onclick="openEditPet(${index})" class="text-blue-500 hover:bg-blue-100 p-1.5 rounded"><i data-lucide="edit" class="w-4 h-4"></i></button><button onclick="deletePet(${index})" class="text-red-500 hover:bg-red-100 p-1.5 rounded"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div></div>`;
            });
            lucide.createIcons();
        }
        function openAddPet() {
            document.getElementById('pet-edit-index').value = ''; document.getElementById('petModalTitle').innerText = '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà'; document.getElementById('input-petName').value = ''; document.getElementById('input-breed').value = ''; document.getElementById('input-weight').value = ''; document.getElementById('input-height').value = '';
            document.getElementById('managePetsModal').classList.add('hidden'); document.getElementById('addPetModal').classList.remove('hidden');
        }
        function openEditPet(index) {
            const pets = getMyPets(); const pet = pets[index];
            document.getElementById('pet-edit-index').value = index; document.getElementById('petModalTitle').innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á'; document.getElementById('input-petName').value = pet.petName; document.getElementById('input-petType').value = pet.petType; document.getElementById('input-breed').value = pet.breed||''; document.getElementById('input-weight').value = pet.weight||''; document.getElementById('input-height').value = pet.height||'';
            document.getElementById('managePetsModal').classList.add('hidden'); document.getElementById('addPetModal').classList.remove('hidden');
        }

        // --- DOCTOR & ADMIN ---
        const defaultDoctors = [{ name: '‡∏™‡∏û.‡∏ç. ‡πÉ‡∏à‡∏î‡∏µ ‡∏£‡∏±‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå', specialty: '‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', image: 'https://images.unsplash.com/photo-1559839734-2b71ea86b48e?auto=format&fit=crop&w=500&q=80' },{ name: '‡∏ô.‡∏™‡∏û. ‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏≤‡∏à ‡∏ß‡πà‡∏≠‡∏á‡πÑ‡∏ß', specialty: '‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠', image: 'https://images.unsplash.com/photo-1622253692010-333f2da6031d?auto=format&fit=crop&w=500&q=80' },{ name: '‡∏™‡∏û.‡∏ç. ‡∏™‡∏ß‡∏¢‡πÉ‡∏™ ‡πÉ‡∏™‡πà‡πÉ‡∏à', specialty: '‡πÇ‡∏£‡∏Ñ‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ', image: 'https://images.unsplash.com/photo-1594824476967-48c8b964273f?auto=format&fit=crop&w=500&q=80' }];
        function getDoctors() { return JSON.parse(localStorage.getItem('clinic_doctors')) || defaultDoctors; }
        function renderLandingDoctors() {
            const grid = document.getElementById('landingDoctorsGrid'); grid.innerHTML = '';
            getDoctors().forEach(d => grid.innerHTML += `<div class="group text-center"><div class="relative w-56 h-56 mx-auto mb-6 rounded-full overflow-hidden shadow-lg border-4 border-teal-50 group-hover:border-teal-200 transition duration-300"><img src="${d.image}" onerror="this.src='https://via.placeholder.com/200'" class="w-full h-full object-cover transform group-hover:scale-110 transition duration-500"></div><h3 class="text-2xl font-bold text-slate-800 mb-1">${d.name}</h3><p class="text-teal-600 font-bold mb-3 uppercase text-sm tracking-wide">${d.specialty}</p></div>`);
        }
        function renderAdminDoctors() {
            const list = document.getElementById('adminDoctorsList'); list.innerHTML = '';
            getDoctors().forEach((d, i) => list.innerHTML += `<div class="flex items-center justify-between bg-slate-50 p-4 rounded-xl border border-slate-200"><div class="flex items-center gap-4"><img src="${d.image}" class="w-12 h-12 rounded-full object-cover"><div><div class="font-bold text-slate-800">${d.name}</div><div class="text-sm text-slate-500">${d.specialty}</div></div></div><div class="flex gap-2"><button onclick="openEditDoctor(${i})" class="p-2 text-blue-600 hover:bg-blue-100 rounded-lg"><i data-lucide="edit" class="w-4 h-4"></i></button><button onclick="deleteDoctor(${i})" class="p-2 text-red-600 hover:bg-red-100 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div></div>`); lucide.createIcons();
        }
        function openAddDoctor() { document.getElementById('doctor-edit-index').value = ''; document.getElementById('doctorModalTitle').innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà'; document.getElementById('doc-input-name').value = ''; document.getElementById('doc-input-specialty').value = ''; document.getElementById('doc-input-image').value = ''; document.getElementById('doc-preview').classList.add('hidden'); document.getElementById('doctorModal').classList.remove('hidden'); }
        function openEditDoctor(i) {
            const d = getDoctors()[i]; document.getElementById('doctor-edit-index').value = i; document.getElementById('doctorModalTitle').innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏≠'; document.getElementById('doc-input-name').value = d.name; document.getElementById('doc-input-specialty').value = d.specialty; document.getElementById('doc-input-image').value = d.image; document.getElementById('doc-preview').src = d.image; document.getElementById('doc-preview').classList.remove('hidden'); document.getElementById('doctorModal').classList.remove('hidden');
        }
        function saveDoctor(e) {
            e.preventDefault(); const f = new FormData(e.target); const file = document.getElementById('doc-input-file').files[0];
            const process = (img) => {
                const d = { name: f.get('name'), specialty: f.get('specialty'), image: img || document.getElementById('doc-input-image').value };
                const idx = document.getElementById('doctor-edit-index').value; let docs = getDoctors();
                if (idx !== "") docs[idx] = d; else docs.push(d);
                localStorage.setItem('clinic_doctors', JSON.stringify(docs)); document.getElementById('doctorModal').classList.add('hidden'); renderAdminDoctors(); renderLandingDoctors();
                showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            };
            if (file) { const r = new FileReader(); r.onload = (ev) => process(ev.target.result); r.readAsDataURL(file); } else process(null);
        }
        function deleteDoctor(i) { showConfirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏≠‡∏ó‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', () => { let d = getDoctors(); d.splice(i, 1); localStorage.setItem('clinic_doctors', JSON.stringify(d)); renderAdminDoctors(); renderLandingDoctors(); showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); }); }

        function openContactModal() { const name = localStorage.getItem('name'); if(name) document.getElementById('contact-name').value = name; document.getElementById('contactModal').classList.remove('hidden'); }
        function sendContactMessage(e) {
            e.preventDefault(); const d = Object.fromEntries(new FormData(e.target)); d.date = new Date().toLocaleString('th-TH');
            let m = JSON.parse(localStorage.getItem('clinic_messages') || '[]'); m.push(d); localStorage.setItem('clinic_messages', JSON.stringify(m));
            showPopup('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î', 'success'); document.getElementById('contactModal').classList.add('hidden'); e.target.reset();
        }
        function loadAdminMessages() {
            const m = JSON.parse(localStorage.getItem('clinic_messages') || '[]'); const c = document.getElementById('adminMessagesList'); c.innerHTML = '';
            if (m.length === 0) { c.innerHTML = '<p class="text-center text-slate-400 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà</p>'; return; }
            m.forEach((msg, i) => { c.innerHTML += `<div class="bg-slate-50 p-4 rounded-xl border border-slate-200 flex justify-between items-center cursor-pointer hover:bg-slate-100 transition" onclick="openMessageDetail(${i})"><div class="flex-1"> <div class="flex justify-between items-center mb-1"> <h4 class="font-bold text-slate-800">${msg.subject}</h4> <div class="text-xs text-slate-400">${msg.date}</div> </div> <div class="text-sm text-slate-500">‡∏à‡∏≤‡∏Å: ${msg.senderName}</div> <div class="text-sm text-slate-400 truncate w-64">${msg.message}</div> </div> <button onclick="event.stopPropagation(); deleteMessage(${i})" class="ml-4 text-red-400 hover:text-red-600 p-2 rounded-full hover:bg-red-50"> <i data-lucide="trash-2" class="w-4 h-4"></i> </button></div>`; });
            lucide.createIcons();
        }

        // üåü New: Open Message Detail Modal
        function openMessageDetail(index) {
            const m = JSON.parse(localStorage.getItem('clinic_messages') || '[]');
            const msg = m[index];
            if (!msg) return;
            document.getElementById('messageDetailModal').classList.remove('hidden');
            document.getElementById('msg-sender').innerText = msg.senderName;
            document.getElementById('msg-subject').innerText = msg.subject;
            document.getElementById('msg-body').innerText = msg.message;
            document.getElementById('msg-date').innerText = msg.date;
        }

        function deleteMessage(i) { showConfirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°?', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', () => { let m = JSON.parse(localStorage.getItem('clinic_messages') || '[]'); m.splice(i, 1); localStorage.setItem('clinic_messages', JSON.stringify(m)); loadAdminMessages(); showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); }); }

        function switchAdminTab(tab) {
            document.getElementById('admin-users').classList.toggle('hidden-section', tab !== 'users'); document.getElementById('admin-apps').classList.toggle('hidden-section', tab !== 'apps'); document.getElementById('admin-doctors').classList.toggle('hidden-section', tab !== 'doctors'); document.getElementById('admin-messages').classList.toggle('hidden-section', tab !== 'messages');
            if(tab === 'users') loadAdminUsers(); else if(tab === 'doctors') renderAdminDoctors(); else if(tab === 'messages') loadAdminMessages(); else loadAdminApps();
        }
        async function loadAdminUsers() { const users = await apiCall('/users'); const tb = document.getElementById('adminUserList'); tb.innerHTML = ''; users.forEach(u => tb.innerHTML += `<tr class="border-b"><td class="p-3">${u.id}</td><td class="p-3">${u.username}</td><td class="p-3">${u.name}</td><td class="p-3"><span class="bg-gray-100 px-2 rounded">${u.role}</span></td><td class="p-3 text-right"><button onclick="deleteUser(${u.id})" class="text-red-500 hover:underline">‡∏•‡∏ö</button></td></tr>`); }
        async function loadAdminApps() { const apps = await apiCall('/appointments'); const tb = document.getElementById('adminAppList'); tb.innerHTML = ''; apps.forEach(a => { const aJson = JSON.stringify(a).replace(/"/g, '&quot;'); tb.innerHTML += `<tr class="border-b"><td class="p-3">${a.id}</td><td class="p-3 text-sm">${a.dateDisplay} ${a.timeDisplay}</td><td class="p-3">${a.ownerName}</td><td class="p-3">${a.petName}</td><td class="p-3 text-xs">${statusToThai(a.status)}</td><td class="p-3 text-right space-x-2"><button onclick="openEditApp(${aJson})" class="text-blue-500">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button onclick="deleteApp(${a.id})" class="text-red-500">‡∏•‡∏ö</button></td></tr>`; }); }
        function openAddStaffModal() { document.getElementById('addStaffModal').classList.remove('hidden'); }
        async function addStaff(e) { e.preventDefault(); await apiCall('/auth/register', 'POST', Object.fromEntries(new FormData(e.target))); document.getElementById('addStaffModal').classList.add('hidden'); loadAdminUsers(); showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); }
        async function deleteUser(id) { showConfirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', async () => { await apiCall(`/users/${id}`, 'DELETE'); loadAdminUsers(); showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); }); }
        async function deleteApp(id) { showConfirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', async () => { await apiCall(`/appointments/${id}`, 'DELETE'); loadAdminApps(); showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); }); }
        function openEditApp(app) { document.getElementById('editAppModal').classList.remove('hidden'); document.getElementById('edit-id').value = app.id; document.getElementById('edit-owner').value = app.ownerName; document.getElementById('edit-pet').value = app.petName; document.getElementById('edit-status').value = app.status; }
        async function updateAppointmentAdmin(e) { e.preventDefault(); const id = document.getElementById('edit-id').value; const body = { ownerName: document.getElementById('edit-owner').value, petName: document.getElementById('edit-pet').value, status: document.getElementById('edit-status').value, date: document.getElementById('edit-date').value, timeSlot: document.getElementById('edit-time').value }; await apiCall(`/appointments/${id}`, 'PUT', body); document.getElementById('editAppModal').classList.add('hidden'); loadAdminApps(); showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); }

        // --- AUTH & NAV ---
        function goHome() { 
            document.getElementById('landing-page').classList.remove('hidden-section');
            document.getElementById('app-screen').classList.add('hidden-section');
            window.scrollTo(0,0);
        }
        function goToDashboard() {
            if(localStorage.getItem('token')) {
                document.getElementById('landing-page').classList.add('hidden-section');
                document.getElementById('app-screen').classList.remove('hidden-section');
            } else { showAuthModal('login'); }
        }
        function handleHeroBooking() { if(localStorage.getItem('token')) goToDashboard(); else showAuthModal('register'); }
        function scrollToSection(id) {
             document.getElementById('landing-page').classList.remove('hidden-section');
             document.getElementById('app-screen').classList.add('hidden-section');
             document.getElementById(id)?.scrollIntoView({behavior: 'smooth'});
        }

        function showAuthModal(mode) { document.getElementById('authModal').classList.remove('hidden'); toggleAuthMode(mode); }
        function toggleAuthMode(mode) {
            document.getElementById('loginForm').style.display = mode === 'login' ? 'block' : 'none';
            document.getElementById('registerForm').style.display = mode === 'register' ? 'block' : 'none';
            document.getElementById('authModalTitle').innerText = mode === 'login' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
        }
        document.getElementById('loginForm').addEventListener('submit', async (e) => { e.preventDefault(); const formData = Object.fromEntries(new FormData(e.target)); const res = await fetch(`${API_URL}/auth/login`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(formData) }); const data = await res.json(); if(res.ok) { localStorage.setItem('token', data.token); localStorage.setItem('role', data.role); localStorage.setItem('name', data.name); localStorage.setItem('username', formData.username); document.getElementById('authModal').classList.add('hidden'); checkAuth(); goToDashboard(); showPopup(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö`, `‡∏Ñ‡∏∏‡∏ì ${data.name}`); } else showPopup('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.error, 'error'); });
        document.getElementById('registerForm').addEventListener('submit', async (e) => { e.preventDefault(); const res = await fetch(`${API_URL}/auth/register`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(Object.fromEntries(new FormData(e.target))) }); if(res.ok) { showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô', 'success'); toggleAuthMode('login'); } else showPopup('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', res.statusText, 'error'); });
        function logout() { localStorage.clear(); location.reload(); }
        function checkAuth() {
            const token = localStorage.getItem('token'); const role = localStorage.getItem('role');
            document.getElementById('nav-user-info').classList.toggle('hidden', !token); document.getElementById('nav-user-info').classList.toggle('flex', !!token); document.getElementById('nav-auth-buttons').classList.toggle('hidden', !!token);
            
            document.getElementById('nav-dashboard-link').classList.add('hidden');
            document.getElementById('nav-contact-us').classList.add('hidden');
            document.getElementById('btn-staff-contact').classList.add('hidden');

            if(token) {
                document.getElementById('user-display-name').innerText = localStorage.getItem('name'); document.getElementById('user-role-display').innerText = role;
                
                if(role === 'customer') { document.getElementById('nav-dashboard-link').classList.remove('hidden'); document.getElementById('nav-contact-us').classList.remove('hidden'); }
                if(role === 'reception' || role === 'doctor') { document.getElementById('btn-staff-contact').classList.remove('hidden'); document.getElementById('btn-staff-contact').classList.add('flex'); }

                ['customer', 'reception', 'doctor', 'admin'].forEach(r => { const el = document.getElementById(`role-${r}`); if(el) el.classList.add('hidden-section'); });
                const roleEl = document.getElementById(`role-${role}`); if (roleEl) roleEl.classList.remove('hidden-section');
                
                document.getElementById('btn-queue-board').classList.toggle('hidden', role !== 'reception');
                document.getElementById('btn-queue-board').classList.toggle('flex', role === 'reception');
                document.getElementById('btn-admin-menu').classList.toggle('hidden', role !== 'admin');
                document.getElementById('btn-admin-menu').classList.toggle('flex', role === 'admin');
                document.getElementById('btn-my-pets').classList.toggle('hidden', role !== 'customer');
                document.getElementById('btn-my-pets').classList.toggle('flex', role === 'customer');

                if(role === 'customer') { document.getElementById('cust-ownerName').value = localStorage.getItem('name'); updatePetDropdown(); loadCustomerHistory(); } else if(role === 'admin') loadAdminUsers(); else loadAppointments();
            }
        }

        async function apiCall(endpoint, method='GET', body=null) {
            const token = localStorage.getItem('token');
            const opts = { method, headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' } };
            if(body) opts.body = JSON.stringify(body);
            const res = await fetch(`${API_URL}${endpoint}`, opts);
            if(res.status === 401 || res.status === 403) { logout(); return null; }
            return res.json();
        }

        async function handleBooking(e) { e.preventDefault(); await apiCall('/appointments', 'POST', Object.fromEntries(new FormData(e.target))); showPopup('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success'); e.target.reset(); document.getElementById('cust-ownerName').value = localStorage.getItem('name'); loadCustomerHistory(); }
        async function loadCustomerHistory() {
            const data = await apiCall('/appointments'); if(!data) return;
            const container = document.getElementById('customerHistory'); container.innerHTML = '';
            data.filter(d => d.ownerName === localStorage.getItem('name')).sort((a,b) => new Date(b.appointmentDate)-new Date(a.appointmentDate)).forEach(app => {
                const appJson = JSON.stringify(app).replace(/"/g, '&quot;');
                const qNo = 'Q' + String(app.id).padStart(3, '0');
                container.innerHTML += `<div onclick="openDetails(${app.id})" class="glass-panel p-4 rounded-xl cursor-pointer hover:bg-white transition flex justify-between items-center border border-transparent hover:border-teal-200"><div><div class="text-xs text-teal-600 font-bold mb-1">${qNo}</div><div class="font-bold text-slate-800">${app.petName}</div><div class="text-xs text-slate-500">${app.dateDisplay} @ ${app.timeDisplay}</div></div><span class="text-xs bg-slate-100 px-2 py-1 rounded font-bold uppercase text-slate-500">${statusToThai(app.status)}</span></div>`;
            });
        }
        
        async function loadAppointments() {
            const data = await apiCall('/appointments'); if(!data) return; appointmentsData = data;
            data.sort((a,b) => {
                 const statusOrder = { 'in_consult': 1, 'waiting': 2, 'pending': 3, 'pharmacy': 4, 'completed': 5 };
                 if(statusOrder[a.status]!==statusOrder[b.status]) return (statusOrder[a.status]||99)-(statusOrder[b.status]||99);
                 return new Date(a.appointmentDate||a.createdAt) - new Date(b.appointmentDate||b.createdAt);
            });
            renderQueueBoard(data);
            const stats = { pending:0, waiting:0, pharmacy:0, completed:0 };
            const searchTerm = document.getElementById('searchInput') ? document.getElementById('searchInput').value.toLowerCase() : '';
            const filteredData = data.filter(app => `${app.ownerName} ${app.petName} ${app.phone||''}`.toLowerCase().includes(searchTerm));
            const tbody = document.getElementById('receptionTable');
            if(tbody) tbody.innerHTML = '';
            filteredData.forEach(app => {
                if(stats[app.status]!==undefined) stats[app.status]++; if(app.status==='in_consult') stats.waiting++;
                if(tbody) {
                    const qNo = 'Q'+String(app.id).padStart(3,'0');
                    let action = `<button onclick="openDetails(${app.id})" class="text-slate-400 text-xs border px-2 py-1 rounded">‡∏î‡∏π</button>`;
                    let badge = 'bg-gray-100';
                    if(app.status==='pending') { badge='bg-yellow-100 text-yellow-700'; action=`<button onclick="updateStatus(${app.id}, 'waiting')" class="bg-teal-100 text-teal-700 px-3 py-1 rounded text-sm font-bold">‚úî ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</button>`; }
                    else if(app.status==='waiting') badge='bg-blue-100 text-blue-700';
                    else if(app.status==='in_consult') badge='bg-indigo-100 text-indigo-700 animate-pulse';
                    else if(app.status==='pharmacy') { badge='bg-purple-100 text-purple-700'; action=`<button onclick="openPaymentModal(${app.id})" class="bg-purple-600 text-white px-3 py-1 rounded text-sm font-bold">‡∏ø ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô</button>`; }
                    else if(app.status==='completed') badge='bg-green-100 text-green-700';
                    const typeBadge = app.isWalkIn ? '<span class="bg-indigo-50 text-indigo-600 text-[10px] px-1 rounded border border-indigo-100">Walk-in</span>' : '<span class="bg-teal-50 text-teal-600 text-[10px] px-1 rounded border border-teal-100">Online</span>';
                    tbody.innerHTML += `<tr class="hover:bg-slate-50 border-b"><td class="p-4 text-sm font-bold text-teal-700">${qNo}</td><td class="p-4 text-sm font-bold text-slate-700">${app.timeDisplay} ${typeBadge}</td><td class="p-4 text-slate-700 font-bold cursor-pointer" onclick="openDetails(${app.id})">${app.petName}</td><td class="p-4 text-sm text-slate-500">${app.ownerName}</td><td class="p-4"><span class="px-2 py-1 rounded-full text-xs font-bold ${badge}">${statusToThai(app.status)}</span></td><td class="p-4 text-right">${action}</td></tr>`;
                }
            });
            if(document.getElementById('stat-pending')) { document.getElementById('stat-pending').innerText = stats.pending; document.getElementById('stat-waiting').innerText = stats.waiting; document.getElementById('stat-pharmacy').innerText = stats.pharmacy; document.getElementById('stat-completed').innerText = stats.completed; }
            
            const docList = document.getElementById('doctorList');
            if(docList) {
                docList.innerHTML = '';
                const patients = filteredData.filter(d => ['waiting', 'in_consult'].includes(d.status));
                if(patients.length === 0) docList.innerHTML = `<div class="p-8 text-center text-slate-400">‡∏ß‡πà‡∏≤‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß)</div>`;
                patients.forEach(p => {
                    const isActive = document.getElementById('exam-id').value == p.id ? 'bg-teal-50 border-l-4 border-teal-500' : 'hover:bg-slate-50 border-transparent';
                    const qNo = 'Q'+String(p.id).padStart(3,'0');
                    docList.innerHTML += `<div onclick="startExam(${p.id}, '${p.petName}', '${p.ownerName}', '${p.breed||''}', '${p.weight||''}', '${qNo}')" class="p-4 cursor-pointer border-l-4 transition ${isActive}"><div class="flex justify-between font-bold text-lg text-slate-800"><span>${qNo} - ${p.petName}</span><span class="text-xs bg-white border px-1 rounded font-mono">${p.timeDisplay}</span></div><div class="text-xs text-slate-500 mt-1">${p.symptoms}</div></div>`;
                });
            }
        }

        renderLandingDoctors();
        checkAuth();
        setInterval(() => { const r = localStorage.getItem('role'); if(r === 'reception' || r === 'doctor') loadAppointments(); if(!document.getElementById('queueBoard').classList.contains('hidden')) loadAppointments(); }, 5000);
    </script>
</body>
</html>